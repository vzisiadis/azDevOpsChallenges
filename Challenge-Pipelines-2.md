# Challenge 04B - Azure Pipelines: Continuous Integration

[< Previous Challenge](./Challenge-Pipelines-1.md) - **[Home](../README.md)** - [Next Challenge >](./Challenge-Pipelines-3.md)

## Introduction

Great we now have some infrastructure and some code, lets build it. In DevOps we automate this process using something called Continuous Integration. Take a moment to review the article below to gain a better understanding of what CI is. 

1. [What is Continuous Integration?](https://docs.microsoft.com/en-us/azure/devops/learn/what-is-continuous-integration)

## Description

In Azure DevOps we use Azure Pipelines to automate our build process. For our application the build process will not only compile our .NET Core application, it should test it, and package it into a Docker Container and publish the container to Azure Container Registry.

- Use the **YAML editor** to create a build pipeline and name it `CI Build`. 
- Add a task to Use .Net version **7.x** and then use the **ASP.NET Core** tasks (the one with the icon with the black box) to build the application code and tests 
- There are the 4 major steps to building a .NET Core application (hint](https://docs.microsoft.com/en-us/azure/devops/pipelines/languages/dotnet-core?view=azure-devops&tabs=designer)). We will exclude the Unit testing at this point  
Add an **ASP.NET Core** task for each command (option)
   1. First we call the `restore` command, this will get all the dependencies that our .net core application needs to compile
   2. Next we call the `build` command, this will actually compile our code
   3. The last .NET Core `build` task in the template is to `publish` the .net core app. Set $(System.DefaultWorkingDirectory)/PublishedWebApp as output path.
Use the required Build Configuration and Project Build and Test paths 
([hint](https://learn.microsoft.com/en-us/azure/devops/pipelines/ecosystems/dotnet-core?view=azure-devops&tabs=dotnetfive))
- Now that our .NET core application is compiled we need to package it into a Docker Container and publish the container to Azure Container Registry, to do this we are going to add a docker task to our build pipeline.
   1. Create a Service Connection of type Docker Registry for your Azure Container Registry
   ([hint](https://learn.microsoft.com/en-us/azure/devops/pipelines/ecosystems/containers/acr-template?view=azure-devops)).
   2. We want to use the `Docker` task with `buildAndPush` command with the following Docker file `**/Dockerfile`, and tag `$(Build.BuildId)`. No additional Build Context is required.
   (NOTE: here we are dynamically pulling the build number from Azure DevOps at run time) 
- Lets kick off a build manually to ensure that we have a working build.
- Next lets notify the team if the build breaks by setting a **Build Option** to create a new Work Item. 
- Now, make and check in a code change that will break the build. Ensure that a work item gets created. 
- Referencing the work item that was automatically created, fix your code, ensure the build looks good, and then resolve the work item that was created.


## Success Criteria

1. Your build should complete without any errors.
2. Review the test results generated by your build. HINT: look in the logs from your build to find where the test run was published. 
3. Using the Azure Portal or CLI you should see your container in your Azure Container Registry Repository
